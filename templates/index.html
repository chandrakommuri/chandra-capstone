<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sentiment-Based Product Recommendation</title>

    <!-- Bootstrap 5 CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f5f7fa;
        }
        .card {
            margin-top: 50px;
            border-radius: 12px;
        }
        .btn-primary {
            border-radius: 20px;
        }
        table th {
            background-color: #f1f1f1;
        }
    </style>
</head>

<body>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">

            <div class="card shadow">
                <div class="card-body">

                    <h3 class="text-center mb-4">
                        ðŸ›’ Sentiment-Based Product Recommendation
                    </h3>

                    <p class="text-center text-muted mb-4">
                        by
                        <strong>Chandra Sekhar Kommuri</strong> <br>
                        Course: <em>UpGrad and IITB Machine Learning & AL</em>
                        Cohort: <em>ML C70</em>
                    </p>

                    <form method="post" class="mb-3" onsubmit="showLoader()">
                        <div class="input-group">
                            <input type="text"
                               class="form-control"
                               name="username"
                               list="usernameList"
                               placeholder="Select or type username"
                               required>
                            <button id="submitBtn" class="btn btn-primary" type="submit">
                                Recommend
                            </button>
                        </div>
                    </form>
                    <datalist id="usernameList">
                        {% for user in usernames %}
                            <option value="{{ user }}">
                        {% endfor %}
                    </datalist>

                    <!-- Loading Spinner -->
                    <div id="loader" class="text-center my-3" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Fetching recommendations...</p>
                    </div>

                    {% if error %}
                        <div class="alert alert-danger text-center">
                            {{ error }}
                        </div>
                    {% endif %}

                    {% if recommendations is not none %}
                        <h5 class="mt-4">Top 5 Recommended Products</h5>

                        <p class="text-muted mt-2">
                            Showing recommendations for user:
                            <strong>{{ username }}</strong>
                        </p>

                        <div class="table-responsive">
                            <table class="table table-bordered table-hover mt-3">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Product Name</th>
                                        <th>Sentiment Score</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for _, row in recommendations.iterrows() %}
                                    <tr>
                                        <td>{{ loop.index }}</td>
                                        <td>{{ row.product_name }}</td>
                                        <td>{{ "%.2f"|format(row.sentiment_score) }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% endif %}

                </div>
            </div>

            <p class="text-center text-muted mt-3">
                Powered by Machine Learning & NLP
            </p>

        </div>
    </div>
</div>

<script>
    function showLoader() {
        document.getElementById('loader').style.display = 'block';
        document.getElementById('submitBtn').disabled = true;
    }
</script>

</body>
</html>
